
<!DOCTYPE html>
<html lang="zh-cn">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Chen Rui&#39;s Blog">
    <title>Unblock Youku on a openWRT Router - Chen Rui&#39;s Blog</title>
    <meta name="author" content="">
    
    
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":null,"sameAs":["https://github.com/","http://stackoverflow.com/users","https://twitter.com/","https://facebook.com/","https://plus.google.com/","https://www.linkedin.com/profile/","mailto"]},"articleBody":"How to unblock youku on your routerTo watched videos from China apps like youku, tencent, sogou, we have to unblock the restrictions put on these website.\nI applied this method to two models of routers: NETGEAR WNDR3700 ($20 on ebay) and R7800 ($160 on ebay) and they perform well enough.\nPrerequisites\nA router that can install openWRT.\nA list of urls needed to be unblocked.\nA shadowsocks proxy (let me know if you don’t have)\nPlenty of time\n\nInstallation of openWRTThe openWRT is a open-source system that can be installed on routers, which can bring many great new functions. It is actively developed and maintained.\nFor R7800, we need to flash openWRT through tftp.\n1) Download the firmware from https://openwrt.org/toh/hwdata/netgear/netgear_r7800. Remember the right file is with suffix of “.img”\nwget http://downloads.openwrt.org/releases/18.06.1/targets/ipq806x/generic/openwrt-18.06.1-ipq806x-netgear_r7800-squashfs-factory.img\n2) Install tftp on the computer(Ubuntu).\nsudo apt-get install tftp\n3) Let the router enter into recovery mode.\na. Power off the router\nb. Keep pressing the reset button using a pin and turn on the router.\nc. Release the reset button until the light blink white. The light of router will blink orange first and then after for a few seconds blink white. \n4) Connect the computer with router to one of the lan ports and mannually set the ip to 192.168.1.2. Because the router’s ip is 192.168.1.1, don’t use this ip for the computer.\nIP: 192.168.1.2\nMASK: 255.255.255.0\nGateway: 192.168.1.1\nDNS: 192.168.1.1 (Not important)\n5) Ping the router from the computer to make sure everthing is all right.\nping 192.168.1.1\n\n## 64 bytes from 192.168.1.1: icmp_seq=1 ttl=47 time=80.3 ms\n## 64 bytes from 192.168.1.1: icmp_seq=2 ttl=47 time=80.3 ms\n## 64 bytes from 192.168.1.1: icmp_seq=3 ttl=47 time=80.3 ms\n## 64 bytes from 192.168.1.1: icmp_seq=4 ttl=47 time=80.2 ms\n6) Connect to the router using tftp and upload the openWRT image.\ntftp 192.168.1.1\n\ntftp&gt; ?\nCommands may be abbreviated.  Commands are:\n\nconnect connect to remote tftp\nmode    set file transfer mode\nput     send file\nget     receive file\nquit    exit tftp\nverbose toggle verbose mode\ntrace   toggle packet tracing\nstatus  show current status\nbinary  set mode to octet\nascii   set mode to netascii\nrexmt   set per-packet retransmission timeout\ntimeout set total retransmission timeout\n?       print help information\n   Change to binary mode. This step is necessary. \ntftp&gt; binary\n   Upload the openWRT img file.\ntftp&gt; put openwrt-18.06.1-ipq806x-netgear_r7800-squashfs-factory.img\n   It will show the size uploaded.\n   Quit tftp.\ntftp&gt; quit\n7) If everything goes well, the blinking white light will turn off and the router will restart with openWRT.\nInstall shadowsocks packagesAfter restarting, the router is running openWRT and we can connect to the router using luci.\nInput 192.168.1.1 in a browser and it will ask you to set a password. After this we can connect to the router using ssh with the password.\nssh root@192.168.1.1\nTo install shdowsocks, we need use the package manager command. First refresh the package list by:\nopkg update\nThen find all the packages related to shawdowsocks.\nopkg find &quot;*shadowsocks*&quot;\nopkg install shadowsocks-client\n\n## Must\nopkg install shadowsocks-libev-config\n\n## Not necessary\nopkg install shadowsocks-libev-ss-local\n\n## Redirect requests to shadowsocks server)\nopkg install shadowsocks-libev-ss-redir \n\n## Build up rules to redirect)\nopkg install shadowsocks-libev-ss-rules \n\n## ss server, not necessary\nopkg install shadowsocks-libev-ss-server\n\n## For DNS requests, not necessary in this case\nopkg install shadowsocks-libev-ss-tunnel\n\n##To simple your life\nopkg install luci-app-shadowsocks\nThis method needs dnsmasq and ipset to build a ip filter.\nThe dnsmasq installed by the image does not support ipset, so we need to install dnsmasq-full\nopkg remove dnsmasq\nopkg install dnsmasq-full\nI believe ipset package is already installed with shadowsocks. We can validate it by:\nopkg install ipset\nConfigurations of shadowsocksI would like to configure shadowsocks using luci, which can save you a lot of time.\n\nAdd a ss proxy server.\nAdd a ss-redir service.\nThe key part is putting the url list to the place that is to be forward to ss proxy server.\nBecause the step 3 needs to add the url to the related ipset hash when starting the service, so it doesn’t allow any bad urls. Or the service can not start. To overcome this flaw, I modified the /usr/bin/ss-rules by adding a new ipset hash set named “_unblock” and build a new iptable rules to this set.\n\nIf you don’t want to revise the ss-rules, you can use the command bellow.\nconfiguratins of ipset and iptablesInitiate a new ipset\nipset -N _unblock hash:ip\nAdd the following iptable rules to iptable:\n## Create shadowsocks router rules\niptables -t nat -N shadowsocks\niptables -t mangle -N shadowsocks\n\niptables -t nat -A shadowsocks -d x.x.x.x -j RETURN \n# x.x.x.x为shadowsocks服务器地址\niptables -t nat -A shadowsocks -d 0.0.0.0/8 -j RETURN\niptables -t nat -A shadowsocks -d 10.0.0.0/8 -j RETURN\niptables -t nat -A shadowsocks -d 127.0.0.0/8 -j RETURN\niptables -t nat -A shadowsocks -d 169.254.0.0/16 -j RETURN\niptables -t nat -A shadowsocks -d 172.16.0.0/12 -j RETURN\niptables -t nat -A shadowsocks -d 192.168.0.0/16 -j RETURN\niptables -t nat -A shadowsocks -d 224.0.0.0/4 -j RETURN\niptables -t nat -A shadowsocks -d 240.0.0.0/4 -j RETURN\n\n## TCP\niptables -t nat -A shadowsocks -p tcp -m set --match-set _unblock_ dst -j REDIRECT --to-port 1080\n\n## UDP using TPROXY\niptables -t mangle -A shadowsocks -p udp -m set --match-set redir dst ! --dport 53 -j TPROXY --on-port 1080 --tproxy-mark 0x01/0x01\nip route add local default dev lo table 100\nip rule add fwmark 0x01/0x01 lookup 100\nip route list table 100\n\n\niptables -t nat -A PREROUTING -p tcp -j shadowsocks\niptables -t mangle -A PREROUTING -j shadowsocks\n\niptables -t nat -A OUTPUT -p tcp -j shadowsocks\niptables -t mangle -A OUTPUT -j shadowsocks\nConfiguration of dnsmasq-fullAdd a conf dir to be loaded by dnsmasq\necho &quot;conf-dir=/etc/dnsmasq.d&quot;&gt;&gt;/etc/dnsmasq.conf\nmkdir /etc/dnsmasq.d\ncd /etc/dnsmasq.d\ntouch redir_test.conf\nRestart dnsmasq after revising config file every time\n/etc/init.d/dnsmasq restart\nTestnetstat -nlp\n\n## listen to the port to see what kind of url \ntcpdump -i br-lan host xxxxx\n\n## Test ipset\nping xxxx\nipset list\nreferencehttp://blog.kompaz.win/2017/03/24/OpenWRT%20Shadowsocks+GFWList%20%E6%B5%81%E9%87%8F%E8%87%AA%E5%8A%A8%E5%88%86%E6%B5%81/\n","dateCreated":"2018-09-14T10:18:12+08:00","dateModified":"2019-03-23T01:49:12+08:00","datePublished":"2018-09-14T10:18:12+08:00","description":"","headline":"Unblock Youku on a openWRT Router","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"https://crotoc.github.io/2018/09/14/Unblock-Youku-on-a-openWRT-Router/"},"publisher":{"@type":"Organization","name":null,"sameAs":["https://github.com/","http://stackoverflow.com/users","https://twitter.com/","https://facebook.com/","https://plus.google.com/","https://www.linkedin.com/profile/","mailto"]},"url":"https://crotoc.github.io/2018/09/14/Unblock-Youku-on-a-openWRT-Router/","keywords":"openWRT, linux, entertainment"}</script>
    <meta name="description" content="How to unblock youku on your routerTo watched videos from China apps like youku, tencent, sogou, we have to unblock the restrictions put on these website. I applied this method to two models of router">
<meta name="keywords" content="openWRT,linux,entertainment">
<meta property="og:type" content="blog">
<meta property="og:title" content="Unblock Youku on a openWRT Router">
<meta property="og:url" content="https://crotoc.github.io/2018/09/14/Unblock-Youku-on-a-openWRT-Router/index.html">
<meta property="og:site_name" content="Chen Rui&#39;s Blog">
<meta property="og:description" content="How to unblock youku on your routerTo watched videos from China apps like youku, tencent, sogou, we have to unblock the restrictions put on these website. I applied this method to two models of router">
<meta property="og:locale" content="zh-cn">
<meta property="og:updated_time" content="2019-03-22T17:49:12.718Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Unblock Youku on a openWRT Router">
<meta name="twitter:description" content="How to unblock youku on your routerTo watched videos from China apps like youku, tencent, sogou, we have to unblock the restrictions put on these website. I applied this method to two models of router">
    
    
        
    
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style-c4ozcsklz4kht2pebhp44xorvyverh23toayhn7i6ubrpyedak24hv1v0hyd.min.css">
    <!--STYLES END-->
    

    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    

<header id="header" data-behavior="4">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a class="header-title-link" href="/ ">Chen Rui&#39;s Blog</a>
    </div>
    
        
            <a class="header-right-picture " href="#about">
        
        
        </a>
    
</header>

            <!-- Define author's picture -->


<nav id="sidebar" data-behavior="4">
    <div class="sidebar-container">
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/ " title="首页">
                    
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">首页</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/all-categories" title="分类">
                    
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">分类</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/all-tags" title="标签">
                    
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">标签</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/all-archives" title="归档">
                    
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">归档</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link open-algolia-search" href="#search" title="搜索">
                    
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">搜索</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="#about" title="关于">
                    
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">关于</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="https://github.com/" target="_blank" rel="noopener" title="GitHub">
                    
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="http://stackoverflow.com/users" target="_blank" rel="noopener" title="Stack Overflow">
                    
                        <i class="sidebar-button-icon fab fa-stack-overflow" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Stack Overflow</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="https://twitter.com/" target="_blank" rel="noopener" title="Twitter">
                    
                        <i class="sidebar-button-icon fab fa-twitter" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Twitter</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="https://facebook.com/" target="_blank" rel="noopener" title="Facebook">
                    
                        <i class="sidebar-button-icon fab fa-facebook" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Facebook</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="https://plus.google.com/" target="_blank" rel="noopener" title="Google Plus">
                    
                        <i class="sidebar-button-icon fab fa-google-plus" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Google Plus</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="https://www.linkedin.com/profile/" target="_blank" rel="noopener" title="LinkedIn">
                    
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/mailto" title="邮箱">
                    
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">邮箱</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/atom.xml" title="RSS">
                    
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="4"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            Unblock Youku on a openWRT Router
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2018-09-14T10:18:12+08:00">
	
		    9月 14, 2018
    	
    </time>
    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <h1 id="How-to-unblock-youku-on-your-router"><a href="#How-to-unblock-youku-on-your-router" class="headerlink" title="How to unblock youku on your router"></a>How to unblock youku on your router</h1><p>To watched videos from China apps like youku, tencent, sogou, we have to unblock the restrictions put on these website.</p>
<p>I applied this method to two models of routers: NETGEAR WNDR3700 ($20 on ebay) and R7800 ($160 on ebay) and they perform well enough.</p>
<h2 id="Prerequisites"><a href="#Prerequisites" class="headerlink" title="Prerequisites"></a>Prerequisites</h2><ol>
<li>A router that can install openWRT.</li>
<li>A list of urls needed to be unblocked.</li>
<li>A shadowsocks proxy (let me know if you don’t have)</li>
<li>Plenty of time</li>
</ol>
<h2 id="Installation-of-openWRT"><a href="#Installation-of-openWRT" class="headerlink" title="Installation of openWRT"></a>Installation of openWRT</h2><p>The openWRT is a open-source system that can be installed on routers, which can bring many great new functions. It is actively developed and maintained.</p>
<p>For R7800, we need to flash openWRT through tftp.</p>
<p>1) Download the firmware from <a href="https://openwrt.org/toh/hwdata/netgear/netgear_r7800" target="_blank" rel="noopener">https://openwrt.org/toh/hwdata/netgear/netgear_r7800</a>. Remember the right file is with suffix of “.img”</p>
<pre><code>wget http://downloads.openwrt.org/releases/18.06.1/targets/ipq806x/generic/openwrt-18.06.1-ipq806x-netgear_r7800-squashfs-factory.img
</code></pre><p>2) Install tftp on the computer(Ubuntu).</p>
<pre><code>sudo apt-get install tftp
</code></pre><p>3) Let the router enter into recovery mode.</p>
<pre><code>a. Power off the router
b. Keep pressing the reset button using a pin and turn on the router.
c. Release the reset button until the light blink white. The light of router will blink orange first and then after for a few seconds blink white. 
</code></pre><p>4) Connect the computer with router to one of the lan ports and mannually set the ip to 192.168.1.2. Because the router’s ip is 192.168.1.1, don’t use this ip for the computer.</p>
<pre><code>IP: 192.168.1.2
MASK: 255.255.255.0
Gateway: 192.168.1.1
DNS: 192.168.1.1 (Not important)
</code></pre><p>5) Ping the router from the computer to make sure everthing is all right.</p>
<pre><code>ping 192.168.1.1

## 64 bytes from 192.168.1.1: icmp_seq=1 ttl=47 time=80.3 ms
## 64 bytes from 192.168.1.1: icmp_seq=2 ttl=47 time=80.3 ms
## 64 bytes from 192.168.1.1: icmp_seq=3 ttl=47 time=80.3 ms
## 64 bytes from 192.168.1.1: icmp_seq=4 ttl=47 time=80.2 ms
</code></pre><p>6) Connect to the router using tftp and upload the openWRT image.</p>
<pre><code>tftp 192.168.1.1

tftp&gt; ?
Commands may be abbreviated.  Commands are:

connect connect to remote tftp
mode    set file transfer mode
put     send file
get     receive file
quit    exit tftp
verbose toggle verbose mode
trace   toggle packet tracing
status  show current status
binary  set mode to octet
ascii   set mode to netascii
rexmt   set per-packet retransmission timeout
timeout set total retransmission timeout
?       print help information
</code></pre><p>   Change to binary mode. This step is necessary. </p>
<pre><code>tftp&gt; binary
</code></pre><p>   Upload the openWRT img file.</p>
<pre><code>tftp&gt; put openwrt-18.06.1-ipq806x-netgear_r7800-squashfs-factory.img
</code></pre><p>   It will show the size uploaded.</p>
<p>   Quit tftp.</p>
<pre><code>tftp&gt; quit
</code></pre><p>7) If everything goes well, the blinking white light will turn off and the router will restart with openWRT.</p>
<h2 id="Install-shadowsocks-packages"><a href="#Install-shadowsocks-packages" class="headerlink" title="Install shadowsocks packages"></a>Install shadowsocks packages</h2><p>After restarting, the router is running openWRT and we can connect to the router using luci.</p>
<p>Input 192.168.1.1 in a browser and it will ask you to set a password. After this we can connect to the router using ssh with the password.</p>
<pre><code>ssh root@192.168.1.1
</code></pre><p>To install shdowsocks, we need use the package manager command. First refresh the package list by:</p>
<pre><code>opkg update
</code></pre><p>Then find all the packages related to shawdowsocks.</p>
<pre><code>opkg find &quot;*shadowsocks*&quot;
opkg install shadowsocks-client

## Must
opkg install shadowsocks-libev-config

## Not necessary
opkg install shadowsocks-libev-ss-local

## Redirect requests to shadowsocks server)
opkg install shadowsocks-libev-ss-redir 

## Build up rules to redirect)
opkg install shadowsocks-libev-ss-rules 

## ss server, not necessary
opkg install shadowsocks-libev-ss-server

## For DNS requests, not necessary in this case
opkg install shadowsocks-libev-ss-tunnel

##To simple your life
opkg install luci-app-shadowsocks
</code></pre><p>This method needs dnsmasq and ipset to build a ip filter.</p>
<p>The dnsmasq installed by the image does not support ipset, so we need to install dnsmasq-full</p>
<pre><code>opkg remove dnsmasq
opkg install dnsmasq-full
</code></pre><p>I believe ipset package is already installed with shadowsocks. We can validate it by:</p>
<pre><code>opkg install ipset
</code></pre><h2 id="Configurations-of-shadowsocks"><a href="#Configurations-of-shadowsocks" class="headerlink" title="Configurations of shadowsocks"></a>Configurations of shadowsocks</h2><p>I would like to configure shadowsocks using luci, which can save you a lot of time.</p>
<ol>
<li>Add a ss proxy server.</li>
<li>Add a ss-redir service.</li>
<li>The key part is putting the url list to the place that is to be forward to ss proxy server.</li>
<li>Because the step 3 needs to add the url to the related ipset hash when starting the service, so it doesn’t allow any bad urls. Or the service can not start. To overcome this flaw, I modified the /usr/bin/ss-rules by adding a new ipset hash set named “_unblock” and build a new iptable rules to this set.</li>
</ol>
<p>If you don’t want to revise the ss-rules, you can use the command bellow.</p>
<h2 id="configuratins-of-ipset-and-iptables"><a href="#configuratins-of-ipset-and-iptables" class="headerlink" title="configuratins of ipset and iptables"></a>configuratins of ipset and iptables</h2><p>Initiate a new ipset</p>
<pre><code>ipset -N _unblock hash:ip
</code></pre><p>Add the following iptable rules to iptable:</p>
<pre><code>## Create shadowsocks router rules
iptables -t nat -N shadowsocks
iptables -t mangle -N shadowsocks

iptables -t nat -A shadowsocks -d x.x.x.x -j RETURN 
# x.x.x.x为shadowsocks服务器地址
iptables -t nat -A shadowsocks -d 0.0.0.0/8 -j RETURN
iptables -t nat -A shadowsocks -d 10.0.0.0/8 -j RETURN
iptables -t nat -A shadowsocks -d 127.0.0.0/8 -j RETURN
iptables -t nat -A shadowsocks -d 169.254.0.0/16 -j RETURN
iptables -t nat -A shadowsocks -d 172.16.0.0/12 -j RETURN
iptables -t nat -A shadowsocks -d 192.168.0.0/16 -j RETURN
iptables -t nat -A shadowsocks -d 224.0.0.0/4 -j RETURN
iptables -t nat -A shadowsocks -d 240.0.0.0/4 -j RETURN

## TCP
iptables -t nat -A shadowsocks -p tcp -m set --match-set _unblock_ dst -j REDIRECT --to-port 1080

## UDP using TPROXY
iptables -t mangle -A shadowsocks -p udp -m set --match-set redir dst ! --dport 53 -j TPROXY --on-port 1080 --tproxy-mark 0x01/0x01
ip route add local default dev lo table 100
ip rule add fwmark 0x01/0x01 lookup 100
ip route list table 100


iptables -t nat -A PREROUTING -p tcp -j shadowsocks
iptables -t mangle -A PREROUTING -j shadowsocks

iptables -t nat -A OUTPUT -p tcp -j shadowsocks
iptables -t mangle -A OUTPUT -j shadowsocks
</code></pre><h2 id="Configuration-of-dnsmasq-full"><a href="#Configuration-of-dnsmasq-full" class="headerlink" title="Configuration of dnsmasq-full"></a>Configuration of dnsmasq-full</h2><p>Add a conf dir to be loaded by dnsmasq</p>
<pre><code>echo &quot;conf-dir=/etc/dnsmasq.d&quot;&gt;&gt;/etc/dnsmasq.conf
mkdir /etc/dnsmasq.d
cd /etc/dnsmasq.d
touch redir_test.conf
</code></pre><p>Restart dnsmasq after revising config file every time</p>
<pre><code>/etc/init.d/dnsmasq restart
</code></pre><h2 id="Test"><a href="#Test" class="headerlink" title="Test"></a>Test</h2><pre><code>netstat -nlp

## listen to the port to see what kind of url 
tcpdump -i br-lan host xxxxx

## Test ipset
ping xxxx
ipset list
</code></pre><h2 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h2><p><a href="http://blog.kompaz.win/2017/03/24/OpenWRT%20Shadowsocks+GFWList%20%E6%B5%81%E9%87%8F%E8%87%AA%E5%8A%A8%E5%88%86%E6%B5%81/" target="_blank" rel="noopener">http://blog.kompaz.win/2017/03/24/OpenWRT%20Shadowsocks+GFWList%20%E6%B5%81%E9%87%8F%E8%87%AA%E5%8A%A8%E5%88%86%E6%B5%81/</a></p>

            

        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">标签</span><br>
                
    <a class="tag tag--primary tag--small t-link" href="/tags/entertainment/">entertainment</a> <a class="tag tag--primary tag--small t-link" href="/tags/linux/">linux</a> <a class="tag tag--primary tag--small t-link" href="/tags/openWRT/">openWRT</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2018/09/25/Modify-the-hotkey-of-Chinese-English-language-switching-in-Windows-10/" data-tooltip="Modify the hotkey of Chinese-English language switching in Windows 10" aria-label="上一篇: Modify the hotkey of Chinese-English language switching in Windows 10">
                
                    <i class="fa fa-angle-left" aria-hidden="true"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">上一篇</span>
                </a>
            </li>
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2018/09/11/rmarkdown-config/" data-tooltip="Setup rmarkdown on server without Rstudio" aria-label="下一篇: Setup rmarkdown on server without Rstudio">
                
                    <span class="hide-xs hide-sm text-small icon-mr">下一篇</span>
                    <i class="fa fa-angle-right" aria-hidden="true"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Diesen Beitrag teilen">
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://crotoc.github.io/2018/09/14/Unblock-Youku-on-a-openWRT-Router/" title="分享到 Facebook">
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://crotoc.github.io/2018/09/14/Unblock-Youku-on-a-openWRT-Router/" title="分享到 Twitter">
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https://crotoc.github.io/2018/09/14/Unblock-Youku-on-a-openWRT-Router/" title="分享到 Google+">
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Nach oben">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2019 null. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2018/09/25/Modify-the-hotkey-of-Chinese-English-language-switching-in-Windows-10/" data-tooltip="Modify the hotkey of Chinese-English language switching in Windows 10" aria-label="上一篇: Modify the hotkey of Chinese-English language switching in Windows 10">
                
                    <i class="fa fa-angle-left" aria-hidden="true"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">上一篇</span>
                </a>
            </li>
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2018/09/11/rmarkdown-config/" data-tooltip="Setup rmarkdown on server without Rstudio" aria-label="下一篇: Setup rmarkdown on server without Rstudio">
                
                    <span class="hide-xs hide-sm text-small icon-mr">下一篇</span>
                    <i class="fa fa-angle-right" aria-hidden="true"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Diesen Beitrag teilen">
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://crotoc.github.io/2018/09/14/Unblock-Youku-on-a-openWRT-Router/" title="分享到 Facebook">
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://crotoc.github.io/2018/09/14/Unblock-Youku-on-a-openWRT-Router/" title="分享到 Twitter">
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https://crotoc.github.io/2018/09/14/Unblock-Youku-on-a-openWRT-Router/" title="分享到 Google+">
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Nach oben">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="4">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://crotoc.github.io/2018/09/14/Unblock-Youku-on-a-openWRT-Router/">
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>分享到 Facebook</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=https://crotoc.github.io/2018/09/14/Unblock-Youku-on-a-openWRT-Router/">
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>分享到 Twitter</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=https://crotoc.github.io/2018/09/14/Unblock-Youku-on-a-openWRT-Router/">
                        <i class="fab fa-google-plus" aria-hidden="true"></i><span>分享到 Google+</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <h4 id="about-card-name"></h4>
        
            <div id="about-card-bio"><p>author.bio</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br>
                <p>author.job</p>

            </div>
        
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->
<script src="/assets/js/script-dbd16rvloemmuxdzniplmnxxvwoz24eya9wol0b7vvmlokgqsjivmb8dnscy.min.js"></script>
<!--SCRIPTS END-->

    



    </body>
</html>
